<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω ph√¢n b·ªï v·ªën</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            color: #ffffff;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 219, 226, 0.15) 0%, transparent 50%);
            background-attachment: fixed;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(13, 17, 43, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .header {
            background: rgba(30, 35, 70, 0.8);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ffffff 0%, #a0a0a0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            opacity: 0.8;
            font-size: 1.1rem;
            color: #8b8b8b;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(30, 35, 70, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .section h2 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .asset-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .asset-card:hover {
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .asset-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #ffffff;
        }

        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .param-group {
            display: flex;
            flex-direction: column;
        }

        .param-group label {
            font-weight: 500;
            margin-bottom: 5px;
            color: #8b8b8b;
            font-size: 0.9rem;
        }

        .param-group input {
            padding: 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .param-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .button {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .results {
            background: rgba(30, 35, 70, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }

        .results h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .allocation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            backdrop-filter: blur(5px);
        }

        .allocation-bar {
            width: 200px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 15px;
        }

        .allocation-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .metric-value.green { color: #22c55e; }
        .metric-value.blue { color: #3b82f6; }
        .metric-value.purple { color: #8b5cf6; }

        .metric-label {
            color: #8b8b8b;
            font-size: 0.9rem;
        }

        .correlation-matrix {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .correlation-cell {
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            font-weight: 500;
        }

        .correlation-header {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .correlation-value {
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .param-grid {
                grid-template-columns: 1fr;
            }
            
            .allocation-item {
                flex-direction: column;
                gap: 10px;
            }
            
            .allocation-bar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Qu·∫£n l√Ω ph√¢n b·ªï v·ªën</h1>
            <p>T·ªëi ∆∞u h√≥a danh m·ª•c ƒë·∫ßu t∆∞ c·ªßa b·∫°n v·ªõi c√¥ng c·ª• ph√¢n t√≠ch t√†i s·∫£n chuy√™n nghi·ªáp</p>
        </div>

        <div class="content">
            <div class="section">
                <h2>üìä C·∫•u H√¨nh T√†i S·∫£n</h2>
                
                <div class="asset-card">
                    <div class="asset-header">
                        <div class="asset-name">üìà C·ªï Phi·∫øu</div>
                    </div>
                    <div class="param-grid">
                        <div class="param-group">
                            <label>T·ªâ l·ªá tƒÉng tr∆∞·ªüng t·ªët nh·∫•t (%)</label>
                            <input type="number" id="stock-best" value="50" step="5" min="-100">
                        </div>
                        <div class="param-group">
                            <label>T·ªâ l·ªá tƒÉng tr∆∞·ªüng x·∫•u nh·∫•t (%)</label>
                            <input type="number" id="stock-worst" value="-50" step="5" min="-100">
                        </div>
                        <div class="param-group">
                            <label>T·ªâ tr·ªçng t·ªëi thi·ªÉu (%)</label>
                            <input type="number" id="stock-min" value="0" step="5" min="0" max="100">
                        </div>
                        <div class="param-group">
                            <label>T·ªâ tr·ªçng t·ªëi ƒëa (%)</label>
                            <input type="number" id="stock-max" value="70" step="5" min="0" max="100">
                        </div>
                        <div class="param-group">
                            <label>T∆∞∆°ng quan v·ªõi C·ªï phi·∫øu</label>
                            <input type="number" id="stock-corr-stock" value="1" step="0.01" min="-1" max="1" readonly>
                        </div>
                        <div class="param-group">
                            <label>T∆∞∆°ng quan v·ªõi Ti·ªÅn m·∫∑t</label>
                            <input type="number" id="stock-corr-cash" value="0" step="0.01" min="-1" max="1">
                        </div>
                    </div>
                </div>

                <div class="asset-card">
                    <div class="asset-header">
                        <div class="asset-name">üí∞ Ti·ªÅn M·∫∑t</div>
                    </div>
                    <div class="param-grid">
                        <div class="param-group">
                            <label>T·ªâ l·ªá tƒÉng tr∆∞·ªüng t·ªët nh·∫•t (%)</label>
                            <input type="number" id="cash-best" value="5" step="0.01">
                        </div>
                        <div class="param-group">
                            <label>T·ªâ l·ªá tƒÉng tr∆∞·ªüng x·∫•u nh·∫•t (%)</label>
                            <input type="number" id="cash-worst" value="5" step="0.01">
                        </div>
                        <div class="param-group">
                            <label>T·ªâ tr·ªçng t·ªëi thi·ªÉu (%)</label>
                            <input type="number" id="cash-min" value="30" step="5" min="0" max="100">
                        </div>
                        <div class="param-group">
                            <label>T·ªâ tr·ªçng t·ªëi ƒëa (%)</label>
                            <input type="number" id="cash-max" value="100" step="5" min="0" max="100">
                        </div>
                        <div class="param-group">
                            <label>T∆∞∆°ng quan v·ªõi C·ªï phi·∫øu</label>
                            <input type="number" id="cash-corr-stock" value="0" step="5" min="-1" max="1">
                        </div>
                        <div class="param-group">
                            <label>T∆∞∆°ng quan v·ªõi Ti·ªÅn m·∫∑t</label>
                            <input type="number" id="cash-corr-cash" value="1" step="0.01" min="-1" max="1" readonly>
                        </div>
                    </div>
                </div>

                <button class="button" onclick="calculateOptimalAllocation()">üîç T√≠nh To√°n Ph√¢n B·ªï T·ªëi ∆Øu</button>
            </div>

            <div class="section">
                <h2>üìà Ma Tr·∫≠n T∆∞∆°ng Quan</h2>
                <div class="correlation-matrix">
                    <div class="correlation-cell correlation-header"></div>
                    <div class="correlation-cell correlation-header">C·ªï phi·∫øu</div>
                    <div class="correlation-cell correlation-header">Ti·ªÅn m·∫∑t</div>
                    <div class="correlation-cell correlation-header">C·ªï phi·∫øu</div>
                    <div class="correlation-cell correlation-value" id="corr-stock-stock">1</div>
                    <div class="correlation-cell correlation-value" id="corr-stock-cash">0</div>
                    <div class="correlation-cell correlation-header">Ti·ªÅn m·∫∑t</div>
                    <div class="correlation-cell correlation-value" id="corr-cash-stock">0</div>
                    <div class="correlation-cell correlation-value" id="corr-cash-cash">1</div>
                </div>
            </div>

            <div class="results" id="results" style="display: none;">
                <h3>üéØ K·∫øt Qu·∫£ Ph√¢n B·ªï T·ªëi ∆Øu</h3>
                
                <div id="allocation-display"></div>
                
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-value green" id="expected-return">-</div>
                        <div class="metric-label">L·ª£i nhu·∫≠n k·ª≥ v·ªçng (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value purple" id="portfolio-risk">-</div>
                        <div class="metric-label">R·ªßi ro danh m·ª•c (%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value blue" id="sharpe-ratio">-</div>
                        <div class="metric-label">T·ªâ s·ªë Sharpe</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value blue" id="diversification">-</div>
                        <div class="metric-label">M·ª©c ƒëa d·∫°ng h√≥a</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // C·∫≠p nh·∫≠t ma tr·∫≠n t∆∞∆°ng quan khi thay ƒë·ªïi input
        function updateCorrelationMatrix() {
            const stockCorrCash = parseFloat(document.getElementById('stock-corr-cash').value);
            const cashCorrStock = parseFloat(document.getElementById('cash-corr-stock').value);
            
            document.getElementById('corr-stock-cash').textContent = stockCorrCash.toFixed(2);
            document.getElementById('corr-cash-stock').textContent = cashCorrStock.toFixed(2);
            
            // ƒê·∫£m b·∫£o t√≠nh ƒë·ªëi x·ª©ng c·ªßa ma tr·∫≠n t∆∞∆°ng quan
            if (stockCorrCash !== cashCorrStock) {
                document.getElementById('cash-corr-stock').value = stockCorrCash;
                document.getElementById('corr-cash-stock').textContent = stockCorrCash.toFixed(2);
            }
        }

        // Th√™m event listeners cho c√°c input t∆∞∆°ng quan
        document.getElementById('stock-corr-cash').addEventListener('input', updateCorrelationMatrix);
        document.getElementById('cash-corr-stock').addEventListener('input', updateCorrelationMatrix);

        /**
         * Calculates optimal asset allocation to maximize expected return
         * @param {Array} assets - Array of asset objects with name, bestGrowth, worstGrowth, minWeight, maxWeight, correlation
         * @returns {Object} - Object containing allocation and expectedReturn
         */
        function calculateOptimalAssetAllocation(assets) {
            // Validate input
            if (!Array.isArray(assets) || assets.length < 2) {
                throw new Error('At least 2 assets are required');
            }

            // Calculate expected returns for each asset
            const assetReturns = assets.map(asset => ({
                name: asset.name,
                expectedReturn: (asset.bestGrowth + asset.worstGrowth) / 2,
                minWeight: asset.minWeight,
                maxWeight: asset.maxWeight
            }));

            // Check if allocation is possible
            const totalMinWeight = assetReturns.reduce((sum, asset) => sum + asset.minWeight, 0);
            const totalMaxWeight = assetReturns.reduce((sum, asset) => sum + asset.maxWeight, 0);

            if (totalMinWeight > 1) {
                throw new Error('Minimum weights exceed 100% - allocation impossible');
            }

            if (totalMaxWeight < 1) {
                throw new Error('Maximum weights sum to less than 100% - allocation impossible');
            }

            let bestAllocation = null;
            let bestReturn = -Infinity;

            // For 2 assets, we can optimize by varying the first asset's weight
            const asset1 = assetReturns[0];
            const asset2 = assetReturns[1];

            // Test different weights for asset1 within its constraints
            const stepSize = 0.01; // 1% increments
            for (let weight1 = asset1.minWeight; weight1 <= asset1.maxWeight; weight1 += stepSize) {
                const weight2 = 1 - weight1;

                // Check if weight2 is within asset2's constraints
                if (weight2 >= asset2.minWeight && weight2 <= asset2.maxWeight) {
                    const portfolioReturn = weight1 * asset1.expectedReturn + weight2 * asset2.expectedReturn;

                    if (portfolioReturn > bestReturn) {
                        bestReturn = portfolioReturn;
                        bestAllocation = {
                            [asset1.name]: weight1,
                            [asset2.name]: weight2
                        };
                    }
                }
            }

            // If no valid allocation found, try boundary cases
            if (!bestAllocation) {
                // Try minimum weight for asset1
                const weight1Min = asset1.minWeight;
                const weight2Min = 1 - weight1Min;
                if (weight2Min >= asset2.minWeight && weight2Min <= asset2.maxWeight) {
                    bestAllocation = {
                        [asset1.name]: weight1Min,
                        [asset2.name]: weight2Min
                    };
                    bestReturn = weight1Min * asset1.expectedReturn + weight2Min * asset2.expectedReturn;
                }
                // Try maximum weight for asset1
                else if (asset1.maxWeight + asset2.minWeight <= 1) {
                    const weight1Max = asset1.maxWeight;
                    const weight2Max = 1 - weight1Max;
                    bestAllocation = {
                        [asset1.name]: weight1Max,
                        [asset2.name]: weight2Max
                    };
                    bestReturn = weight1Max * asset1.expectedReturn + weight2Max * asset2.expectedReturn;
                }
            }

            if (!bestAllocation) {
                throw new Error('No valid allocation found within constraints');
            }

            return {
                allocation: bestAllocation,
                expectedReturn: bestReturn
            };
        }

        function calculateOptimalAllocation() {
            try {
                // L·∫•y d·ªØ li·ªáu ƒë·∫ßu v√†o
                const stockBest = parseFloat(document.getElementById('stock-best').value) / 100;
                const stockWorst = parseFloat(document.getElementById('stock-worst').value) / 100;
                const stockMin = parseFloat(document.getElementById('stock-min').value) / 100;
                const stockMax = parseFloat(document.getElementById('stock-max').value) / 100;
                
                const cashBest = parseFloat(document.getElementById('cash-best').value) / 100;
                const cashWorst = parseFloat(document.getElementById('cash-worst').value) / 100;
                const cashMin = parseFloat(document.getElementById('cash-min').value) / 100;
                const cashMax = parseFloat(document.getElementById('cash-max').value) / 100;
                
                const correlation = parseFloat(document.getElementById('stock-corr-cash').value);

                // T·∫°o m·∫£ng assets theo format y√™u c·∫ßu
                const assets = [
                    {
                        name: "C·ªï phi·∫øu",
                        bestGrowth: stockBest,
                        worstGrowth: stockWorst,
                        minWeight: stockMin,
                        maxWeight: stockMax,
                        correlation: { "C·ªï phi·∫øu": 1, "Ti·ªÅn m·∫∑t": correlation }
                    },
                    {
                        name: "Ti·ªÅn m·∫∑t",
                        bestGrowth: cashBest,
                        worstGrowth: cashWorst,
                        minWeight: cashMin,
                        maxWeight: cashMax,
                        correlation: { "C·ªï phi·∫øu": correlation, "Ti·ªÅn m·∫∑t": 1 }
                    }
                ];

                // S·ª≠ d·ª•ng function m·ªõi ƒë·ªÉ t√≠nh to√°n
                const result = calculateOptimalAssetAllocation(assets);
                
                // T√≠nh to√°n c√°c ch·ªâ s·ªë b·ªï sung cho hi·ªÉn th·ªã
                const stockWeight = result.allocation["C·ªï phi·∫øu"];
                const cashWeight = result.allocation["Ti·ªÅn m·∫∑t"];
                
                // T√≠nh to√°n l·ª£i nhu·∫≠n k·ª≥ v·ªçng v√† ƒë·ªô l·ªách chu·∫©n cho risk calculation
                const stockReturn = (stockBest + stockWorst) / 2;
                const stockVolatility = (stockBest - stockWorst) / 4;
                const cashReturn = (cashBest + cashWorst) / 2;
                const cashVolatility = (cashBest - cashWorst) / 4;

                // T√≠nh portfolio risk v√† Sharpe ratio
                const portfolioVariance = 
                    Math.pow(stockWeight * stockVolatility, 2) + 
                    Math.pow(cashWeight * cashVolatility, 2) + 
                    2 * stockWeight * cashWeight * stockVolatility * cashVolatility * correlation;
                const portfolioVolatility = Math.sqrt(portfolioVariance);
                const sharpeRatio = portfolioVolatility > 0 ? result.expectedReturn / portfolioVolatility : 0;
                
                // T√≠nh m·ª©c ƒëa d·∫°ng h√≥a
                const diversification = 1 - Math.pow(Math.abs(correlation), 2) * stockWeight * cashWeight * 4;

                // Hi·ªÉn th·ªã k·∫øt qu·∫£
                displayResults({
                    stockWeight: stockWeight,
                    cashWeight: cashWeight,
                    expectedReturn: result.expectedReturn,
                    risk: portfolioVolatility,
                    sharpeRatio: sharpeRatio,
                    diversification: diversification
                });

            } catch (error) {
                alert('L·ªói t√≠nh to√°n: ' + error.message);
                console.error('Calculation error:', error);
            }
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            const allocationDisplay = document.getElementById('allocation-display');
            
            // Hi·ªÉn th·ªã ph√¢n b·ªï
            allocationDisplay.innerHTML = `
                <div class="allocation-item">
                    <span><strong>üìà C·ªï Phi·∫øu</strong></span>
                    <div class="allocation-bar">
                        <div class="allocation-fill" style="width: ${results.stockWeight * 100}%"></div>
                    </div>
                    <span><strong>${(results.stockWeight * 100).toFixed(1)}%</strong></span>
                </div>
                <div class="allocation-item">
                    <span><strong>üí∞ Ti·ªÅn M·∫∑t</strong></span>
                    <div class="allocation-bar">
                        <div class="allocation-fill" style="width: ${results.cashWeight * 100}%"></div>
                    </div>
                    <span><strong>${(results.cashWeight * 100).toFixed(1)}%</strong></span>
                </div>
            `;
            
            // C·∫≠p nh·∫≠t c√°c ch·ªâ s·ªë
            document.getElementById('expected-return').textContent = (results.expectedReturn * 100).toFixed(2);
            document.getElementById('portfolio-risk').textContent = (results.risk * 100).toFixed(2);
            document.getElementById('sharpe-ratio').textContent = results.sharpeRatio.toFixed(3);
            document.getElementById('diversification').textContent = (results.diversification * 100).toFixed(1) + '%';
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Kh·ªüi t·∫°o ma tr·∫≠n t∆∞∆°ng quan
        updateCorrelationMatrix();
    </script>
</body>
</html>